_format_version: "3.0"
_transform: true

certificates:
  - cert: |
      -----BEGIN CERTIFICATE-----
      MIIDnDCCAyOgAwIBAgISBu2ZVxUNayZDspneFFhVN4T/MAoGCCqGSM49BAMDMDIx
      CzAJBgNVBAYTAlVTMRYwFAYDVQQKEw1MZXQncyBFbmNyeXB0MQswCQYDVQQDEwJF
      NjAeFw0yNTA4MDMxMzUwMTFaFw0yNTExMDExMzUwMTBaMCMxITAfBgNVBAMTGHRy
      YWNraW8uYW1pc2FoZGV2LmNvbS5icjBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IA
      BFCmzbBLcVOZiOCys2qyjclZOoeOz77m/DR1ggcov36dqYV09I5M0S8wP1iRk9yj
      BwCOs1gR/5HrP3ceNgTWm7ijggImMIICIjAOBgNVHQ8BAf8EBAMCB4AwHQYDVR0l
      BBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMAwGA1UdEwEB/wQCMAAwHQYDVR0OBBYE
      FL0SPCMAg2Z6E/o+JSUL4L2bD37SMB8GA1UdIwQYMBaAFJMnRpgDqVFojpjWxEJI
      2yO/WJTSMDIGCCsGAQUFBwEBBCYwJDAiBggrBgEFBQcwAoYWaHR0cDovL2U2Lmku
      bGVuY3Iub3JnLzAjBgNVHREEHDAaghh0cmFja2lvLmFtaXNhaGRldi5jb20uYnIw
      EwYDVR0gBAwwCjAIBgZngQwBAgEwLgYDVR0fBCcwJTAjoCGgH4YdaHR0cDovL2U2
      LmMubGVuY3Iub3JnLzEyOC5jcmwwggEDBgorBgEEAdZ5AgQCBIH0BIHxAO8AdgDt
      PEvW6AbCpKIAV9vLJOI4Ad9RL+3EhsVwDyDdtz4/4AAAAZhwaAQrAAAEAwBHMEUC
      ID/glju46XuAKYlDRm8q9nxo1+TiVZjGGrAvCVRcseMrAiEA80NrjA605K6HbJGE
      aJXSzXDe/ffvnbk2MaCr8L8a/LwAdQAN4fIwK9MNwUBiEgnqVS78R3R8sdfpMO8O
      Qh60fk6qNAAAAZhwaAQhAAAEAwBGMEQCIDMxlV0V+l4Sr4kpRdKs0WGTPfItTZ9U
      cRQMfG0JvPdQAiA9jhqwYAxLuKDQKd7HFTlSBPtqSDKQrzMRLWy4F2HQ5TAKBggq
      hkjOPQQDAwNnADBkAjAwnl/I52RjIDeEKCg85ktxZylXKLzW0HF0GMU6httirKI6
      Hilt1OXbloKYeWjFShsCMCHjdcutQOg3sVAs0ED0kZ77UYDjBqD07l8Jdy9oSndP
      y/QXS46XktFW14LFe3uSCA==
      -----END CERTIFICATE-----
    key: |
      -----BEGIN PRIVATE KEY-----
      MIGHAgEAMBMGByqGSM49AgEGCCqGSM49AwEHBG0wawIBAQQgpJt+Ff66roe0iJ93
      1Uifb0VDERT8lvi7TEepAVGXXA+hRANCAARQps2wS3FTmYjgsrNqso3JWTqHjs++
      5vw0dYIHKL9+namFdPSOTNEvMD9YkZPcowcAjrNYEf+R6z93HjYE1pu4
      -----END PRIVATE KEY-----
    snis:
      - name: trackio.amisahdev.com.br

  - cert: |
      -----BEGIN CERTIFICATE-----
      MIIDojCCAymgAwIBAgISBaEna8M2VksB/iy0mhPwMMO4MAoGCCqGSM49BAMDMDIx
      CzAJBgNVBAYTAlVTMRYwFAYDVQQKEw1MZXQncyBFbmNyeXB0MQswCQYDVQQDEwJF
      NjAeFw0yNTA4MDMxNDM5MTlaFw0yNTExMDExNDM5MThaMCYxJDAiBgNVBAMTG3Ry
      YWNraW8tb2MuYW1pc2FoZGV2LmNvbS5icjBZMBMGByqGSM49AgEGCCqGSM49AwEH
      A0IABLKmzQraP/uYoOdIfXGsSGLfHD4ukb/vAhNWmeRAfKNFyeSYA5m4LyVdXDUk
      KXDnBg7ogKYh0Qq255QA94Q4V/+jggIpMIICJTAOBgNVHQ8BAf8EBAMCB4AwHQYD
      VR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMAwGA1UdEwEB/wQCMAAwHQYDVR0O
      BBYEFCvQbsIM6MsiGNk/zSwAgI9yyrURMB8GA1UdIwQYMBaAFJMnRpgDqVFojpjW
      xEJI2yO/WJTSMDIGCCsGAQUFBwEBBCYwJDAiBggrBgEFBQcwAoYWaHR0cDovL2U2
      LmkubGVuY3Iub3JnLzAmBgNVHREEHzAdght0cmFja2lvLW9jLmFtaXNhaGRldi5j
      b20uYnIwEwYDVR0gBAwwCjAIBgZngQwBAgEwLQYDVR0fBCYwJDAioCCgHoYcaHR0
      cDovL2U2LmMubGVuY3Iub3JnLzU3LmNybDCCAQQGCisGAQQB1nkCBAIEgfUEgfIA
      8AB1ABoE/0nQVB1Ar/agw7/x2MRnL07s7iNAaJhrF0Au3Il9AAABmHCVAY4AAAQD
      AEYwRAIgHKev28vV+/g8U94NWVbvH04n2btBs33ITZ8YwkBBWYUCIBLA98iUlDPN
      gIIea7BonC1pTT9K4Usv5d9oMhzYDuOhAHcAEvFONL1TckyEBhnDjz96E/jntWKH
      iJxtMAWE6+WGJjoAAAGYcJUBWgAABAMASDBGAiEA+wskfFkiwep7PIxWL2POsf+S
      0erDuXU6bw4UzU6cLMMCIQCAWa/vT3qG2Cs4ZLb5TaTqpuEAyOdWqV4tcpGW4Xrd
      2DAKBggqhkjOPQQDAwNnADBkAjBrXHRqTDb1htaDcfez8a1ig5KZ/wv1F0p3+jf+
      RGrms4x9EdVgUkLd+jbYKWiwT7gCMERubJanfFlWf30+oabexpLHSMoQg5Soq/eq
      zyCHlEBIWYPP1UUIciid43n2aQO/cg==
      -----END CERTIFICATE-----
    key: |
      -----BEGIN PRIVATE KEY-----
      MIGHAgEAMBMGByqGSM49AgEGCCqGSM49AwEHBG0wawIBAQQgbM1SYCgscqd8tk3t
      KeugdlMgQTpxg2CJaiHWs+AgF4GhRANCAASyps0K2j/7mKDnSH1xrEhi3xw+LpG/
      7wITVpnkQHyjRcnkmAOZuC8lXVw1JClw5wYO6ICmIdEKtueUAPeEOFf/
      -----END PRIVATE KEY-----
    snis:
      - name: trackio-oc.amisahdev.com.br

  - cert: |
      -----BEGIN CERTIFICATE-----
      MIIDnjCCAySgAwIBAgISBVezhfmCah4c1wMecIg/f3C1MAoGCCqGSM49BAMDMDIx
      CzAJBgNVBAYTAlVTMRYwFAYDVQQKEw1MZXQncyBFbmNyeXB0MQswCQYDVQQDEwJF
      NTAeFw0yNTA4MDYxNjEzMTRaFw0yNTExMDQxNjEzMTNaMCMxITAfBgNVBAMTGG1h
      aWxwaXQuYW1pc2FoZGV2LmNvbS5icjBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IA
      BJQg1NRHshiGcBQXkr6gQ5zRGXh3/6Fmj3Gw+gsDDrDx+OoJocHWpAKbHTjZeyN2
      34o8sXVNoJE0q2IG3LyaldejggInMIICIzAOBgNVHQ8BAf8EBAMCB4AwHQYDVR0l
      BBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMAwGA1UdEwEB/wQCMAAwHQYDVR0OBBYE
      FEeCBtBYAaHtOdnSOFDSPafdp4AZMB8GA1UdIwQYMBaAFJ8rX888IU+dBLftKyzE
      xnCL0tcNMDIGCCsGAQUFBwEBBCYwJDAiBggrBgEFBQcwAoYWaHR0cDovL2U1Lmku
      bGVuY3Iub3JnLzAjBgNVHREEHDAaghhtYWlscGl0LmFtaXNhaGRldi5jb20uYnIw
      EwYDVR0gBAwwCjAIBgZngQwBAgEwLQYDVR0fBCYwJDAioCCgHoYcaHR0cDovL2U1
      LmMubGVuY3Iub3JnLzU0LmNybDCCAQUGCisGAQQB1nkCBAIEgfYEgfMA8QB3ABoE
      /0nQVB1Ar/agw7/x2MRnL07s7iNAaJhrF0Au3Il9AAABmIBeDlkAAAQDAEgwRgIh
      ALKdrtA1klndRlxyaSVEqKa9SiJtc02GyvJKGonoz27pAiEA2g0ovAnjJLjcG/eS
      qpJVGjdF3iA7arZSzJoPcCKKiU8AdgDd3Mo0ldfhFgXnlTL6x5/4PRxQ39sAOhQS
      dgosrLvIKgAAAZiAXg5lAAAEAwBHMEUCIQDRQbn4R25+Q11MGbKTmMiEJ1n2V5nh
      hMbA5GGhY3Yq+wIgKIjmCHwrDQCAK1T5daTR07ci8Ux5x2tyiVsXs+2KKRswCgYI
      KoZIzj0EAwMDaAAwZQIwM1uNjG/KqZ5ijwZvwKDUY2n+1Cfyb8iSj3CC4GfWTc0L
      1pnZ/UuUdJ2AyaWjyFo6AjEAxF4j+MpbeVU5NMdbtsbu+eGcFt3Qh/cO/7N+lbD4
      fBAADc+GXV7vI+YfGpuh4Rxa
      -----END CERTIFICATE-----
    key: |
      -----BEGIN PRIVATE KEY-----
      MIGHAgEAMBMGByqGSM49AgEGCCqGSM49AwEHBG0wawIBAQQgMgasCIs19lAF6s91
      F2x62pxhw9TBI60mwCgXlOF6ykmhRANCAASUINTUR7IYhnAUF5K+oEOc0Rl4d/+h
      Zo9xsPoLAw6w8fjqCaHB1qQCmx042Xsjdt+KPLF1TaCRNKtiBty8mpXX
      -----END PRIVATE KEY-----
    snis:
      - name: mailpit.amisahdev.com.br

services:
- name: tracking
  url: http://tracking_service:3000
  routes:
  - name: tracking
    paths:
    - /track/docs/
    - ~/track/*
    methods:
    - GET
    - POST
    - PUT
    - DELETE
    - OPTIONS
    - HEAD
    strip_path: false
    path_handling: v1


- name: django
  url: http://django:5000
  routes:
  - name: django
    paths:
    - /home
    - /home/
    - /about/
    - ~/accounts/*
    - ~/users/*
    - ~/admin/*
    - ~/api/*
    methods:
    - GET
    - POST
    - PUT
    - DELETE
    - OPTIONS
    - HEAD
    strip_path: false
    path_handling: v1

- name: grafana
  url: http://grafana:3000
  routes:
  - name: grafana
    paths:
    - /grafana
    - /grafana/
    - ~/grafana/*
    methods:
    - GET
    - POST
    - PUT
    - DELETE
    - OPTIONS
    - HEAD
    strip_path: false
    path_handling: v1

- name: loki
  url: http://loki:3100
  routes:
    - name: loki
      paths:
        - /loki
        - ~/loki/*
      methods:
        - GET
        - POST
      strip_path: false
      path_handling: v1

- name: prometheus
  url: http://prometheus:9090
  routes:
    - name: prometheus
      paths:
        - /prometheus
        - ~/prometheus/*
      methods:
        - GET
        - POST
      strip_path: true
      path_handling: v1

- name: mailpit
  url: http://mailpit:8025
  routes:
    - name: mailpit-prefix-route
      hosts:
      - mailpit.amisahdev.com.br
      protocols:
        - http
        - https
      paths:
        - /mailpit
        - /mailpit/
      strip_path: true

    - name: mailpit-dist-route
      hosts:
        - mailpit.amisahdev.com.br
      paths:
        - /dist
        - /dist/
      strip_path: false

plugins:
  - name: request-transformer
    config:
      replace:
        headers:
          - "Host:trackio.amisahdev.com.br"
          - "X-Forwarded-Proto:https"

  - name: rate-limiting
    service: django
    config:
      minute: 100
      policy: local
      limit_by: ip